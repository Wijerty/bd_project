<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Визуализация Базы Данных Антифрод Системы</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --bg-color: #ecf0f1;
            --card-bg: #ffffff;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: #333;
        }

        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header h1 {
            margin: 0;
            font-weight: 500;
            font-size: 24px;
        }

        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 30px;
            margin-bottom: 30px;
        }

        .card h2 {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--bg-color);
            padding-bottom: 10px;
            margin-top: 0;
        }

        .diagram-wrapper {
            display: flex;
            justify-content: center;
            overflow-x: auto;
            padding: 20px 0;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Архитектура и Схема Данных Антифрод Системы</h1>
    </div>

    <div class="container">
        
        <!-- High Level Overview -->
        <div class="card">
            <h2>1. Логическая Структура (High-Level)</h2>
            <p>Группировка сущностей по функциональным областям: Пользователи, Финансы, Сетевое окружение и Безопасность.</p>
            <div class="diagram-wrapper">
                <div class="mermaid">
                    graph TD
                        subgraph Users [Пользовательские Данные]
                            C(Client)
                            CR(ClientRelationship)
                            C --- CR
                        end

                        subgraph Finance [Финансы]
                            A(Account)
                            T(Transaction)
                            A --> T
                        end

                        subgraph Network [Сетевое Окружение]
                            D(Device)
                            IP(IPAddress)
                        end

                        subgraph Security [Безопасность и Правила]
                            R(Rule)
                            BL(Blacklist)
                        end

                        C -->|Владеет| A
                        T -->|Использует| D
                        T -->|С адреса| IP
                        
                        style Users fill:#e1f5fe,stroke:#01579b,stroke-width:2px
                        style Finance fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
                        style Network fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
                        style Security fill:#fce4ec,stroke:#880e4f,stroke-width:2px
                </div>
            </div>
        </div>

        <!-- Detailed ER Diagram -->
        <div class="card">
            <h2>2. Детальная ER-Диаграмма (Схема БД)</h2>
            <p>Подробное описание таблиц, полей и связей.</p>
            <div class="legend">
                <div class="legend-item"><span class="dot" style="background: #ECECFF; border: 1px solid #81B1DB;"></span>Сущности</div>
                <div class="legend-item"><span class="dot" style="background: #333;"></span>Связи (1:1, 1:N)</div>
            </div>
            <div class="diagram-wrapper">
                <div class="mermaid">
                    erDiagram
                        Client ||--o{ Account : "owns"
                        Client ||--o{ ClientRelationship : "has"
                        
                        Account ||--o{ Transaction : "sends/receives"
                        
                        Transaction }|--|| Device : "uses"
                        Transaction }|--|| IPAddress : "from"
                        
                        Client {
                            int client_id PK
                            string full_name
                            string kyc_status
                            float risk_level
                            bool is_blocked
                        }

                        Account {
                            int account_id PK
                            string type "card/bank"
                            float balance
                            float limits
                        }

                        Transaction {
                            int id PK
                            float amount
                            datetime date
                            string status
                            float fraud_score
                            bool is_flagged
                        }

                        Device {
                            int id PK
                            string fingerprint
                            string type
                            string os_browser
                        }

                        IPAddress {
                            int id PK
                            string ip
                            string geo_location
                            bool is_proxy
                        }

                        Rule {
                            int id PK
                            string name
                            string condition
                            float weight
                        }

                        Blacklist {
                            int id PK
                            string entity_type
                            string reason
                        }
                </div>
            </div>
        </div>

    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'base',
            themeVariables: {
                primaryColor: '#e1f5fe',
                edgeLabelBackground: '#ffffff',
                tertiaryColor: '#fff'
            }
        });
    </script>
</body>
</html>
